<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cookie Banner Configuration - Ark CMS</title>
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
</head>
<body>
    <div class="app-layout">
        <aside class="sidebar">
            <img src="../assets/images/ark_logo.png" alt="Ark CMS Logo" class="logo">
            <nav class="sidebar-nav">
                <span class="nav-section-title">[Data Fiduciary Name]</span>
                <ul>
                    <li><a href="df_admin_dashboard.html"><span class="material-symbols-outlined">dashboard</span> Dashboard</a></li>
                </ul>
                <!-- ... other nav sections ... -->
                 <span class="nav-section-title">Integrations</span>
                <ul>
                    <li><a href="df_admin_api_keys.html"><span class="material-symbols-outlined">key</span> API Keys</a></li>
                    <li><a href="#"><span class="material-symbols-outlined">webhook</span> Webhooks (Future)</a></li>
                    <li><a href="df_admin_cookie_banner_config.html" class="active"><span class="material-symbols-outlined">cookie</span> Cookie Banner</a></li>
                </ul>
                <!-- ... other nav items ... -->
                 <div class="sidebar-footer" style="margin-top: auto;">
                     <a href="df_admin_login.html" class="btn btn-secondary btn-full-width"><span class="material-symbols-outlined">logout</span> Logout</a>
                </div>
            </nav>
        </aside>
        <main class="main-content">
            <header class="app-header">
                <div class="hamburger-menu">
                    <span class="material-symbols-outlined">menu</span>
                </div>
                <h1 class="page-title">Cookie Banner Configuration</h1>
                 <div class="user-menu">
                    <div class="user-menu-trigger">
                        <div class="avatar">AD</div>
                        <span class="user-name-display ark-body-default">[DF Admin Name]</span>
                        <span class="material-symbols-outlined">arrow_drop_down</span>
                    </div>
                    <div class="user-menu-dropdown">
                        <a href="df_admin_profile.html">My Profile</a>
                        <a href="df_admin_login.html">Logout</a>
                    </div>
                </div>
            </header>

            <form id="cookieBannerConfigForm">
                <div class="card mb-4">
                    <div class="card-header">
                        <h2 class="ark-h3">Banner Settings</h2>
                    </div>
                    <div class="card-content" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: var(--space-lg);">
                        <div class="form-group">
                            <label for="bannerPosition" class="ark-label">Banner Position</label>
                            <select id="bannerPosition" name="bannerPosition" class="form-control">
                                <option value="bottom">Bottom</option>
                                <option value="top">Top</option>
                                <option value="floating-left">Floating Left</option>
                                <option value="floating-right">Floating Right</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="bannerBgColor" class="ark-label">Banner Background Color</label>
                            <input type="color" id="bannerBgColor" name="bannerBgColor" class="form-control" value="#FAFBFC">
                        </div>
                        <div class="form-group">
                            <label for="bannerTextColor" class="ark-label">Banner Text Color</label>
                            <input type="color" id="bannerTextColor" name="bannerTextColor" class="form-control" value="#172B4D">
                        </div>
                        <div class="form-group">
                            <label for="buttonColor" class="ark-label">Button Color</label>
                            <input type="color" id="buttonColor" name="buttonColor" class="form-control" value="#0052CC">
                        </div>
                        <div class="form-group">
                            <label for="buttonTextColor" class="ark-label">Button Text Color</label>
                            <input type="color" id="buttonTextColor" name="buttonTextColor" class="form-control" value="#FFFFFF">
                        </div>
                        <div class="form-group" style="grid-column: 1 / -1;">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="showAcceptAll" name="showAcceptAll" checked>
                                <label class="form-check-label" for="showAcceptAll">Show 'Accept All' Button</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="showDeclineAll" name="showDeclineAll">
                                <label class="form-check-label" for="showDeclineAll">Show 'Decline All' Button</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="showCustomize" name="showCustomize" checked>
                                <label class="form-check-label" for="showCustomize">Show 'Customize' Button</label>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card mb-4">
                    <div class="card-header d-flex justify-between align-center">
                        <h2 class="ark-h3">Cookie Categories</h2>
                        <button type="button" class="btn btn-sm btn-secondary" data-modal-target="cookieCategoryModal" id="addCookieCategoryBtn">
                            <span class="material-symbols-outlined">add</span> Add Category
                        </button>
                    </div>
                    <div class="card-content table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Category Name</th>
                                    <th>Description</th>
                                    <th>Always Enabled</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="cookieCategoriesTable">
                                <tr>
                                    <td>Essential</td>
                                    <td>[Necessary for website basic functionality]</td>
                                    <td><span class="badge badge-success">Yes</span></td>
                                    <td><!-- No actions for essential --></td>
                                </tr>
                                <tr>
                                    <td>Analytics</td>
                                    <td>[Help us understand website traffic and usage patterns.]</td>
                                    <td><span class="badge badge-neutral">No</span></td>
                                    <td class="table-actions">
                                        <button type="button" class="btn btn-sm btn-subtle" data-modal-target="cookieCategoryModal" data-name="Analytics" data-desc="[Help us understand website traffic and usage patterns.]" data-always-enabled="false"><span class="material-symbols-outlined icon-only">edit</span></button>
                                        <button type="button" class="btn btn-sm btn-danger" onclick="this.closest('tr').remove();"><span class="material-symbols-outlined icon-only">delete</span></button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Marketing</td>
                                    <td>[Used to personalize advertising and track campaign effectiveness.]</td>
                                    <td><span class="badge badge-neutral">No</span></td>
                                     <td class="table-actions">
                                        <button type="button" class="btn btn-sm btn-subtle" data-modal-target="cookieCategoryModal" data-name="Marketing" data-desc="[Used to personalize advertising and track campaign effectiveness.]" data-always-enabled="false"><span class="material-symbols-outlined icon-only">edit</span></button>
                                        <button type="button" class="btn btn-sm btn-danger" onclick="this.closest('tr').remove();"><span class="material-symbols-outlined icon-only">delete</span></button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="card mb-4 tabs">
                    <div class="card-header">
                        <h2 class="ark-h3">Banner Text</h2>
                        <div class="tab-list">
                            <div class="tab-item active" data-tab="bannerTextEn">English (EN)</div>
                            <div class="tab-item" data-tab="bannerTextHi">Hindi (HI)</div>
                            <!-- Add more language tabs as needed -->
                        </div>
                    </div>
                    <div class="card-content">
                        <div class="tab-panel active" id="bannerTextEn">
                            <div class="form-group">
                                <label for="bannerTextEnInput" class="ark-label">Banner Text (EN)</label>
                                <textarea id="bannerTextEnInput" name="bannerTextEn" class="form-control" rows="3">We use cookies to enhance your experience. By continuing to visit this site you agree to our use of cookies.</textarea>
                            </div>
                            <div class="form-group">
                                <label for="privacyLinkTextEn" class="ark-label">Privacy Policy Link Text (EN)</label>
                                <input type="text" id="privacyLinkTextEn" name="privacyLinkTextEn" class="form-control" value="Learn more">
                            </div>
                             <div class="form-group">
                                <label for="privacyLinkUrlEn" class="ark-label">Privacy Policy URL (EN)</label>
                                <input type="url" id="privacyLinkUrlEn" name="privacyLinkUrlEn" class="form-control" value="https://example.com/privacy">
                            </div>
                            <div class="form-group">
                                <label for="customizeTextEn" class="ark-label">Customize Screen Intro Text (EN)</label>
                                <textarea id="customizeTextEn" name="customizeTextEn" class="form-control" rows="2">Manage your cookie preferences below. You can enable or disable categories as you wish.</textarea>
                            </div>
                        </div>
                        <div class="tab-panel" id="bannerTextHi">
                            <!-- Hindi text fields -->
                             <div class="form-group">
                                <label for="bannerTextHiInput" class="ark-label">बैनर टेक्स्ट (HI)</label>
                                <textarea id="bannerTextHiInput" name="bannerTextHi" class="form-control" rows="3">हम आपके अनुभव को बेहतर बनाने के लिए कुकीज़ का उपयोग करते हैं। इस साइट पर आना जारी रखते हुए आप हमारी कुकीज़ के उपयोग के लिए सहमत हैं।</textarea>
                            </div>
                            <!-- ... other Hindi fields ... -->
                        </div>
                    </div>
                </div>
                
                <div class="card mb-4">
                    <div class="card-header">
                         <h2 class="ark-h3">Integration</h2>
                    </div>
                    <div class="card-content">
                        <p class="ark-body-default">Copy and paste the following code snippet into the `<head>` section of your website.</p>
                        <pre class="ark-body-small" style="background-color: var(--ark-gray-100); padding: var(--space-md); border-radius: var(--border-radius-md); overflow-x: auto;"><code><script src="https://cdn.arkcms.com/cookie-banner.js" data-df-id="[YOUR_DF_TENANT_ID]" async defer></script></code></pre>
                        <button type="button" class="btn btn-subtle mt-2" onclick="copyToClipboard(this.previousElementSibling.textContent)"><span class="material-symbols-outlined">content_copy</span> Copy Code</button>
                    </div>
                </div>

                <div class="text-right mt-4 mb-4">
                    <button type="button" class="btn btn-secondary mr-2" id="previewBannerBtn">Preview Banner</button>
                    <button type="submit" class="btn btn-primary">Save Configuration</button>
                </div>
            </form>
        </main>
    </div>

    <!-- Add/Edit Cookie Category Modal -->
    <div class="modal-overlay" id="cookieCategoryModal">
        <div class="modal-container">
            <div class="modal-header">
                <h3 class="modal-title ark-h3" id="cookieCategoryModalTitle">Add Cookie Category</h3>
                <button class="modal-close-btn"><span class="material-symbols-outlined">close</span></button>
            </div>
            <form id="cookieCategoryForm">
                <input type="hidden" id="editCookieCategoryNameHidden">
                <div class="modal-body">
                    <div class="form-group">
                        <label for="cookieCategoryName" class="ark-label">Category Name <span style="color: var(--ark-red-500);">*</span></label>
                        <input type="text" id="cookieCategoryName" name="cookieCategoryName" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="cookieCategoryDesc" class="ark-label">Description <span style="color: var(--ark-red-500);">*</span></label>
                        <textarea id="cookieCategoryDesc" name="cookieCategoryDesc" class="form-control" rows="3" required></textarea>
                    </div>
                    <div class="form-group">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="cookieCategoryAlwaysEnabled" name="cookieCategoryAlwaysEnabled">
                            <label class="form-check-label" for="cookieCategoryAlwaysEnabled">Always Enabled (Cannot be disabled by user)</label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary modal-close-btn">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="saveCookieCategoryBtn">Save Category</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Cookie Banner Preview (Very basic) -->
    <div id="cookieBannerPreview" style="display:none; position: fixed; bottom: 0; left: 0; width: 100%; background-color: #FAFBFC; color: #172B4D; padding: 20px; border-top: 1px solid #DFE1E6; z-index: 2000; box-shadow: 0 -2px 10px rgba(0,0,0,0.1);">
        <div style="max-width: 1000px; margin: auto; display: flex; align-items: center; justify-content: space-between;">
            <p id="previewBannerText" style="margin-right: 20px;">We use cookies...</p>
            <div id="previewButtons" style="display: flex; gap: 10px;">
                <button class="btn btn-sm btn-primary" id="previewAcceptAll">Accept All</button>
                <button class="btn btn-sm btn-secondary" id="previewDeclineAll" style="display:none;">Decline All</button>
                <button class="btn btn-sm btn-subtle" id="previewCustomize">Customize</button>
            </div>
        </div>
         <button onclick="document.getElementById('cookieBannerPreview').style.display='none'" style="position:absolute; top:5px; right:5px; background:none; border:none; font-size:18px; cursor:pointer;">×</button>
    </div>


    <script src="../assets/js/main.js"></script>
    <script>
        populateUserSpecificElements("DF Admin Name");

        const cookieCategoryModal = document.getElementById('cookieCategoryModal');
        const cookieCategoryForm = document.getElementById('cookieCategoryForm');
        const cookieCategoryModalTitle = document.getElementById('cookieCategoryModalTitle');
        const editCookieCategoryNameHidden = document.getElementById('editCookieCategoryNameHidden');
        const saveCookieCategoryBtn = document.getElementById('saveCookieCategoryBtn');

        document.getElementById('addCookieCategoryBtn').addEventListener('click', () => {
            cookieCategoryModalTitle.textContent = 'Add Cookie Category';
            cookieCategoryForm.reset();
            editCookieCategoryNameHidden.value = '';
            saveCookieCategoryBtn.textContent = 'Save Category';
        });

        document.querySelectorAll('button[data-modal-target="cookieCategoryModal"]').forEach(btn => {
            if (btn.id === 'addCookieCategoryBtn') return;
            btn.addEventListener('click', (e) => {
                const target = e.currentTarget;
                cookieCategoryModalTitle.textContent = `Edit Cookie Category - ${target.dataset.name}`;
                cookieCategoryForm.reset();
                editCookieCategoryNameHidden.value = target.dataset.name;
                document.getElementById('cookieCategoryName').value = target.dataset.name;
                document.getElementById('cookieCategoryDesc').value = target.dataset.desc;
                document.getElementById('cookieCategoryAlwaysEnabled').checked = (target.dataset.alwaysEnabled === 'true');
                saveCookieCategoryBtn.textContent = 'Update Category';
            });
        });
        
        cookieCategoryForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const name = document.getElementById('cookieCategoryName').value;
            const desc = document.getElementById('cookieCategoryDesc').value;
            const alwaysEnabled = document.getElementById('cookieCategoryAlwaysEnabled').checked;
            // Mock: Add/Update in table
            alert(`Cookie category '${name}' ${editCookieCategoryNameHidden.value ? 'updated' : 'added'} (Mock).`);
            cookieCategoryModal.classList.remove('active');
        });

        document.getElementById('cookieBannerConfigForm').addEventListener('submit', (e) => {
            e.preventDefault();
            alert('Cookie Banner Configuration Saved (Mock)!');
        });
        
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('Code copied to clipboard!');
            }).catch(err => {
                alert('Failed to copy code.');
            });
        }

        // Basic Preview Logic
        document.getElementById('previewBannerBtn').addEventListener('click', () => {
            const banner = document.getElementById('cookieBannerPreview');
            const bannerText = document.getElementById('previewBannerText');
            const acceptAllBtn = document.getElementById('previewAcceptAll');
            const declineAllBtn = document.getElementById('previewDeclineAll');
            const customizeBtn = document.getElementById('previewCustomize');

            // Apply styles
            banner.style.backgroundColor = document.getElementById('bannerBgColor').value;
            banner.style.color = document.getElementById('bannerTextColor').value;
            bannerText.textContent = document.getElementById('bannerTextEnInput').value + " "; // Add space for link
            
            const privacyLink = document.createElement('a');
            privacyLink.href = document.getElementById('privacyLinkUrlEn').value;
            privacyLink.textContent = document.getElementById('privacyLinkTextEn').value;
            privacyLink.style.color = document.getElementById('buttonColor').value; // Use button color for link
            privacyLink.target = "_blank";
            bannerText.appendChild(privacyLink);


            acceptAllBtn.style.backgroundColor = document.getElementById('buttonColor').value;
            acceptAllBtn.style.color = document.getElementById('buttonTextColor').value;
            declineAllBtn.style.backgroundColor = document.getElementById('buttonColor').value; // Or different style
            declineAllBtn.style.color = document.getElementById('buttonTextColor').value;
            customizeBtn.style.backgroundColor = '#fff'; // Example subtle style
            customizeBtn.style.color = document.getElementById('buttonColor').value;
            customizeBtn.style.borderColor = document.getElementById('buttonColor').value;


            // Show/hide buttons
            acceptAllBtn.style.display = document.getElementById('showAcceptAll').checked ? 'inline-flex' : 'none';
            declineAllBtn.style.display = document.getElementById('showDeclineAll').checked ? 'inline-flex' : 'none';
            customizeBtn.style.display = document.getElementById('showCustomize').checked ? 'inline-flex' : 'none';
            
            // Position
            const position = document.getElementById('bannerPosition').value;
            banner.style.bottom = 'auto'; banner.style.top = 'auto'; banner.style.left = 'auto'; banner.style.right = 'auto';
            banner.style.width = '100%';
            if (position === 'bottom') banner.style.bottom = '0';
            else if (position === 'top') banner.style.top = '0';
            else if (position === 'floating-left') { banner.style.left = '20px'; banner.style.bottom = '20px'; banner.style.width = 'auto'; banner.style.maxWidth='400px';}
            else if (position === 'floating-right') { banner.style.right = '20px'; banner.style.bottom = '20px'; banner.style.width = 'auto'; banner.style.maxWidth='400px';}

            banner.style.display = 'block';
        });

    </script>
</body>
</html>