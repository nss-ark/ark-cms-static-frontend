<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Purpose Details - Ark CMS</title>
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
</head>
<body>
    <div class="app-layout">
        <aside class="sidebar">
            <img src="../assets/images/ark_logo.png" alt="Ark CMS Logo" class="logo">
            <nav class="sidebar-nav">
                <span class="nav-section-title">[Data Fiduciary Name]</span>
                <ul>
                    <li><a href="df_admin_dashboard.html"><span class="material-symbols-outlined">dashboard</span> Dashboard</a></li>
                </ul>
                <span class="nav-section-title">Consent Management</span>
                <ul>
                    <li><a href="df_admin_notices.html"><span class="material-symbols-outlined">feed</span> Notices</a></li>
                    <li><a href="df_admin_purposes.html" class="active"><span class="material-symbols-outlined">target</span> Purposes</a></li>
                    <li><a href="df_admin_categories.html"><span class="material-symbols-outlined">category</span> Data Categories</a></li>
                    <li><a href="df_admin_consent_records.html"><span class="material-symbols-outlined">folder_shared</span> Consent Records</a></li>
                </ul>
                <!-- ... other nav items ... -->
                 <div class="sidebar-footer" style="margin-top: auto;">
                     <a href="df_admin_login.html" class="btn btn-secondary btn-full-width"><span class="material-symbols-outlined">logout</span> Logout</a>
                </div>
            </nav>
        </aside>
        <main class="main-content">
            <header class="app-header">
                <div class="hamburger-menu">
                    <span class="material-symbols-outlined">menu</span>
                </div>
                <h1 class="page-title">Purpose Details - <span id="purposeCodeDisplay">ACC_MGMT</span></h1>
                 <div class="user-menu">
                    <div class="user-menu-trigger">
                        <div class="avatar">AD</div>
                        <span class="user-name-display ark-body-default">[DF Admin Name]</span>
                        <span class="material-symbols-outlined">arrow_drop_down</span>
                    </div>
                    <div class="user-menu-dropdown">
                        <a href="df_admin_profile.html">My Profile</a>
                        <a href="df_admin_login.html">Logout</a>
                    </div>
                </div>
            </header>

            <nav aria-label="breadcrumb" class="mb-4">
                <ol class="ark-body-small" style="display: flex; list-style: none; padding: 0;">
                    <li><a href="df_admin_purposes.html" class="ark-link">Purposes</a></li>
                    <li class="ark-body-small" style="margin: 0 var(--space-xs); color: var(--ark-gray-500);">></li>
                    <li class="ark-body-small" aria-current="page" id="breadcrumbPurposeCode">ACC_MGMT</li>
                </ol>
            </nav>

            <div class="card mb-4">
                <div class="card-header d-flex justify-between align-center">
                    <h2 class="ark-h3">Purpose Information</h2>
                    <button class="btn btn-secondary btn-sm" data-modal-target="purposeInfoModal" id="editPurposeInfoBtn">
                        <span class="material-symbols-outlined">edit</span> Edit Purpose Info
                    </button>
                </div>
                <div class="card-content">
                    <p><strong>Purpose Code:</strong> <span id="infoPurposeCode">ACC_MGMT</span></p>
                    <p><strong>Short Description:</strong> <span id="infoShortDesc">[Account Creation & Management]</span></p>
                    <p><strong>Detailed Description:</strong> <span id="infoDetailedDesc">[Detailed description for Account Creation & Management including user authentication, profile storage, and service access.]</span></p>
                    <p><strong>Sensitivity Flag:</strong> <span id="infoSensitivity">No</span></p>
                    <p><strong>Retention Period:</strong> <span id="infoRetention">[While account active + 1yr]</span></p>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="ark-h3">Linked Data Categories</h2>
                </div>
                <div class="card-content">
                    <table class="table mb-4">
                        <thead>
                            <tr>
                                <th>Category Code</th>
                                <th>Description</th>
                                <th>Sensitive</th>
                                <th>Mandatory for Purpose</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="linkedCategoriesTableBody">
                            <tr>
                                <td>EMAIL</td>
                                <td>[Email Address]</td>
                                <td>No</td>
                                <td><span class="badge badge-success">Yes</span></td>
                                <td><button class="btn btn-sm btn-danger" onclick="removeCategory(this)"><span class="material-symbols-outlined icon-only">delete</span></button></td>
                            </tr>
                            <tr>
                                <td>FULL_NAME</td>
                                <td>[Full Name]</td>
                                <td>No</td>
                                <td><span class="badge badge-success">Yes</span></td>
                                <td><button class="btn btn-sm btn-danger" onclick="removeCategory(this)"><span class="material-symbols-outlined icon-only">delete</span></button></td>
                            </tr>
                             <tr>
                                <td>PASSWORD_HASH</td>
                                <td>[Hashed Password]</td>
                                <td>Yes</td>
                                <td><span class="badge badge-success">Yes</span></td>
                                <td><button class="btn btn-sm btn-danger" onclick="removeCategory(this)"><span class="material-symbols-outlined icon-only">delete</span></button></td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <hr class="my-3">
                    <h4 class="ark-h4">Add Data Category to this Purpose</h4>
                    <form id="addCategoryToPurposeForm" class="d-flex align-center" style="gap: var(--space-md);">
                        <div class="form-group" style="flex-grow: 1;">
                            <label for="selectDataCategory" class="ark-label">Select Data Category:</label>
                            <select id="selectDataCategory" name="dataCategory" class="form-control">
                                <option value="PHONE_NUM">[Phone Number]</option>
                                <option value="ADDRESS">[Physical Address]</option>
                                <option value="IP_ADDRESS">[IP Address]</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <div class="form-check" style="margin-top: var(--space-lg); /* Align with button */">
                                <input class="form-check-input" type="checkbox" id="isMandatoryForPurpose" name="isMandatory">
                                <label class="form-check-label" for="isMandatoryForPurpose">Mandatory for Purpose</label>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary" style="align-self: flex-end; margin-bottom: var(--space-md);">Add Category</button>
                    </form>
                </div>
            </div>
        </main>
    </div>

    <!-- Edit Purpose Info Modal (similar to create purpose modal) -->
    <div class="modal-overlay" id="purposeInfoModal">
        <div class="modal-container" style="max-width: 600px;">
            <div class="modal-header">
                <h3 class="modal-title ark-h3">Edit Purpose Information</h3>
                <button class="modal-close-btn"><span class="material-symbols-outlined">close</span></button>
            </div>
            <form id="editPurposeInfoForm">
                <div class="modal-body">
                    <div class="form-group">
                        <label for="editInfoPurposeCode" class="ark-label">Purpose Code</label>
                        <input type="text" id="editInfoPurposeCode" class="form-control" readonly>
                    </div>
                    <div class="form-group">
                        <label for="editInfoShortDesc" class="ark-label">Short Description <span style="color: var(--ark-red-500);">*</span></label>
                        <input type="text" id="editInfoShortDesc" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="editInfoDetailedDesc" class="ark-label">Detailed Description <span style="color: var(--ark-red-500);">*</span></label>
                        <textarea id="editInfoDetailedDesc" class="form-control" rows="4" required></textarea>
                    </div>
                     <div class="form-group">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="editInfoContainsSensitive" name="containsSensitiveData">
                            <label class="form-check-label" for="editInfoContainsSensitive">Contains Sensitive Data</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="editInfoRetention" class="ark-label">Retention Period <span style="color: var(--ark-red-500);">*</span></label>
                        <input type="text" id="editInfoRetention" class="form-control" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary modal-close-btn">Cancel</button>
                    <button type="submit" class="btn btn-primary">Update Purpose Info</button>
                </div>
            </form>
        </div>
    </div>

    <script src="../assets/js/main.js"></script>
    <script>
        populateUserSpecificElements("DF Admin Name");

        const purposeIdFromUrl = new URLSearchParams(window.location.search).get('id') || 'ACC_MGMT';
        document.getElementById('purposeCodeDisplay').textContent = purposeIdFromUrl;
        document.getElementById('breadcrumbPurposeCode').textContent = purposeIdFromUrl;
        
        // Mock data load for Purpose Info section
        const infoPurposeCode = document.getElementById('infoPurposeCode');
        const infoShortDesc = document.getElementById('infoShortDesc');
        const infoDetailedDesc = document.getElementById('infoDetailedDesc');
        const infoSensitivity = document.getElementById('infoSensitivity');
        const infoRetention = document.getElementById('infoRetention');
        // In real app, fetch this data
        infoPurposeCode.textContent = purposeIdFromUrl;
        if (purposeIdFromUrl === 'ACC_MGMT') {
            infoShortDesc.textContent = '[Account Creation & Management]';
            infoDetailedDesc.textContent = '[Detailed description for Account Creation & Management including user authentication, profile storage, and service access.]';
            infoSensitivity.textContent = 'No';
            infoRetention.textContent = '[While account active + 1yr]';
        } else if (purposeIdFromUrl === 'MKTG_EMAIL') {
            infoShortDesc.textContent = '[Marketing Email Communications]';
            infoDetailedDesc.textContent = '[To send you promotional offers, newsletters, and updates about our products and services.]';
            infoSensitivity.textContent = 'No';
            infoRetention.textContent = '[Until unsubscribed]';
        }


        // Edit Purpose Info Modal Population
        document.getElementById('editPurposeInfoBtn').addEventListener('click', () => {
            document.getElementById('editInfoPurposeCode').value = infoPurposeCode.textContent;
            document.getElementById('editInfoShortDesc').value = infoShortDesc.textContent;
            document.getElementById('editInfoDetailedDesc').value = infoDetailedDesc.textContent;
            document.getElementById('editInfoContainsSensitive').checked = (infoSensitivity.textContent === 'Yes');
            document.getElementById('editInfoRetention').value = infoRetention.textContent;
        });
        
        document.getElementById('editPurposeInfoForm').addEventListener('submit', (e) => {
            e.preventDefault();
            // Update the main page display (mock)
            infoShortDesc.textContent = document.getElementById('editInfoShortDesc').value;
            infoDetailedDesc.textContent = document.getElementById('editInfoDetailedDesc').value;
            infoSensitivity.textContent = document.getElementById('editInfoContainsSensitive').checked ? 'Yes' : 'No';
            infoRetention.textContent = document.getElementById('editInfoRetention').value;
            alert('Purpose information updated (Mock).');
            document.getElementById('purposeInfoModal').classList.remove('active');
        });

        // Add Category to Purpose Form
        document.getElementById('addCategoryToPurposeForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const selectedCategoryOption = document.getElementById('selectDataCategory').selectedOptions[0];
            if (!selectedCategoryOption) return;

            const categoryCode = selectedCategoryOption.value;
            const categoryDesc = selectedCategoryOption.textContent;
            const isMandatory = document.getElementById('isMandatoryForPurpose').checked;

            const tableBody = document.getElementById('linkedCategoriesTableBody');
            const newRow = tableBody.insertRow();
            newRow.innerHTML = `
                <td>${categoryCode}</td>
                <td>${categoryDesc}</td>
                <td>No</td> <!-- Mock sensitivity -->
                <td><span class="badge ${isMandatory ? 'badge-success' : 'badge-neutral'}">${isMandatory ? 'Yes' : 'No'}</span></td>
                <td><button class="btn btn-sm btn-danger" onclick="removeCategory(this)"><span class="material-symbols-outlined icon-only">delete</span></button></td>
            `;
            alert(`Data Category '${categoryDesc}' added to purpose (Mock).`);
            e.target.reset(); // Reset the form
        });

        function removeCategory(button) {
            if (confirm('Are you sure you want to remove this data category from the purpose?')) {
                button.closest('tr').remove();
                alert('Data category removed (Mock).');
            }
        }
    </script>
</body>
</html>